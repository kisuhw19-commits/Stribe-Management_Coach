<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Stribe Coach</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f172a; min-height: 100vh; color: #e2e8f0; }
        
        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        .screen { display: none; min-height: 100vh; }
        .screen.active { display: block; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-wrapper { min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; background: linear-gradient(135deg, #1e3a5f, #0f172a); }
        .login-container { background: rgba(30, 41, 59, 0.95); border: 1px solid #334155; border-radius: 20px; padding: 40px 30px; width: 100%; max-width: 380px; backdrop-filter: blur(10px); }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo span { font-size: 50px; }
        .logo h1 { font-size: 26px; color: #f1f5f9; margin-top: 10px; font-weight: 700; }
        .logo p { font-size: 14px; color: #64748b; margin-top: 5px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; color: #94a3b8; font-size: 14px; margin-bottom: 8px; font-weight: 500; }
        .input-group input { width: 100%; padding: 14px 16px; border: 1px solid #334155; border-radius: 12px; font-size: 16px; background: #1e293b; color: #f1f5f9; transition: all 0.2s; }
        .input-group input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .login-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .login-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .error-msg { color: #f87171; text-align: center; margin-top: 15px; font-size: 14px; display: none; }
        
        /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ */
        .dashboard { padding: 20px; padding-top: 30px; max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .header-title { font-size: 24px; font-weight: 700; color: #f1f5f9; }
        .header-date { font-size: 13px; color: #64748b; margin-top: 4px; }
        .logout-btn { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; color: #f87171; padding: 8px 16px; border-radius: 8px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .logout-btn:hover { background: rgba(239, 68, 68, 0.3); }
        
        /* ë©”ë‰´ ê·¸ë¦¬ë“œ */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .menu-card { background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 16px; padding: 24px 20px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .menu-card:hover { transform: translateY(-2px); border-color: #3b82f6; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2); }
        .menu-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3b82f6, #8b5cf6); opacity: 0; transition: opacity 0.3s; }
        .menu-card:hover::before { opacity: 1; }
        .menu-icon { font-size: 32px; margin-bottom: 12px; }
        .menu-title { font-size: 16px; font-weight: 600; color: #f1f5f9; margin-bottom: 6px; }
        .menu-desc { font-size: 12px; color: #64748b; line-height: 1.4; }
        
        /* ì„œë¸Œ í˜ì´ì§€ í—¤ë” */
        .sub-header { background: linear-gradient(135deg, #1e293b, #0f172a); padding: 20px; padding-top: 50px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 100; }
        .back-btn { background: none; border: none; font-size: 24px; color: #94a3b8; cursor: pointer; padding: 5px; }
        .sub-title { font-size: 20px; font-weight: 700; color: #f1f5f9; }
        .sub-content { padding: 20px; padding-bottom: 100px; max-width: 800px; margin: 0 auto; }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { padding: 10px 18px; background: #1e293b; border: 1px solid #334155; border-radius: 10px; color: #94a3b8; font-size: 14px; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
        .tab-btn.active { background: #3b82f6; border-color: #3b82f6; color: white; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 16px; padding: 20px; margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #334155; }
        .card-title { font-size: 16px; font-weight: 600; color: #f1f5f9; display: flex; align-items: center; gap: 8px; }
        .card-badge { background: #3b82f6; color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        
        /* ì„ ìˆ˜ ì„ íƒ */
        .player-select-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .player-chip { padding: 12px 16px; background: #0f172a; border: 1px solid #334155; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .player-chip:hover { border-color: #3b82f6; }
        .player-chip.selected { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .player-chip .name { font-size: 14px; font-weight: 600; color: #f1f5f9; }
        .player-chip .birth { font-size: 11px; color: #64748b; margin-top: 2px; }
        
        /* í¼ ìš”ì†Œ */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; color: #94a3b8; margin-bottom: 8px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 14px 16px; background: #0f172a; border: 1px solid #334155; border-radius: 10px; font-size: 15px; color: #f1f5f9; transition: all 0.2s; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .form-textarea { min-height: 120px; resize: vertical; font-family: inherit; }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        
        /* ì²´í¬ë°•ìŠ¤ ê·¸ë¦¬ë“œ */
        .checkbox-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: #0f172a; border: 1px solid #334155; border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .checkbox-item:hover { border-color: #3b82f6; }
        .checkbox-item.checked { background: rgba(59, 130, 246, 0.15); border-color: #3b82f6; }
        .checkbox-item input { display: none; }
        .checkbox-box { width: 20px; height: 20px; border: 2px solid #475569; border-radius: 5px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .checkbox-item.checked .checkbox-box { background: #3b82f6; border-color: #3b82f6; }
        .checkbox-item.checked .checkbox-box::after { content: 'âœ“'; color: white; font-size: 12px; }
        .checkbox-label { font-size: 14px; color: #e2e8f0; }
        
        /* ë²„íŠ¼ */
        .btn { padding: 14px 24px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .btn-secondary { background: #334155; color: #f1f5f9; }
        .btn-full { width: 100%; }
        
        /* ë¡œë”© */
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid #334155; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ìƒíƒœ ë©”ì‹œì§€ */
        .status-msg { padding: 12px; border-radius: 8px; text-align: center; margin-top: 15px; font-size: 14px; }
        .status-success { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .status-error { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        
        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ */
        .image-upload-area { border: 2px dashed #334155; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .image-upload-area:hover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
        .image-upload-area.has-image { border-style: solid; border-color: #3b82f6; }
        .image-preview { max-width: 100%; max-height: 200px; border-radius: 8px; margin-top: 10px; }
        .image-upload-icon { font-size: 40px; margin-bottom: 10px; }
        .image-upload-text { color: #64748b; font-size: 14px; }
        
        /* ì»¨ë””ì…˜ í…Œì´ë¸” */
        .condition-table-wrapper { overflow-x: auto; }
        .condition-table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 600px; }
        .condition-table th, .condition-table td { padding: 10px 8px; text-align: center; border: 1px solid #334155; }
        .condition-table th { background: #1e3a5f; color: #e2e8f0; font-weight: 600; }
        .condition-table td { background: #0f172a; color: #e2e8f0; }
        .category-group { background: #1e293b !important; font-weight: 600; color: #94a3b8; writing-mode: vertical-rl; text-orientation: mixed; padding: 15px 8px !important; }
        .category-cell { background: #162032 !important; color: #94a3b8; font-weight: 500; text-align: left !important; padding-left: 12px !important; }
        .no-data { color: #475569; }
        .rpe-cell { padding: 4px 8px; border-radius: 4px; font-weight: 600; }
        .rpe-low { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .rpe-mid { background: rgba(234, 179, 8, 0.2); color: #facc15; }
        .rpe-high { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state { text-align: center; padding: 60px 20px; color: #64748b; }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; }
        .empty-state .text { font-size: 16px; }
        
        .refresh-btn { background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; color: #60a5fa; padding: 8px 16px; border-radius: 8px; font-size: 13px; cursor: pointer; }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="screen active" id="loginScreen">
        <div class="login-wrapper">
            <div class="login-container">
                <div class="logo">
                    <span>âš½</span>
                    <h1>Stribe Coach</h1>
                    <p>ì½”ì¹˜ ì „ìš© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                </div>
                <div class="input-group">
                    <label>ì•„ì´ë””</label>
                    <input type="text" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button class="login-btn" id="loginBtn">ë¡œê·¸ì¸</button>
                <p class="error-msg" id="errorMsg"></p>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <div class="screen" id="mainScreen">
        <div class="dashboard">
            <div class="header">
                <div>
                    <div class="header-title">âš½ Stribe Coach</div>
                    <div class="header-date" id="todayDate"></div>
                </div>
                <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            <div class="menu-grid">
                <div class="menu-card" data-menu="condition">
                    <div class="menu-icon">ğŸ“Š</div>
                    <div class="menu-title">Personal Condition</div>
                    <div class="menu-desc">ì„ ìˆ˜ë³„ ì»¨ë””ì…˜ í™•ì¸</div>
                </div>
                <div class="menu-card" data-menu="training">
                    <div class="menu-icon">ğŸ“</div>
                    <div class="menu-title">Training Log</div>
                    <div class="menu-desc">í›ˆë ¨ ì¼ì§€ ì‘ì„±</div>
                </div>
                <div class="menu-card" data-menu="strategy">
                    <div class="menu-icon">ğŸ¯</div>
                    <div class="menu-title">Conditioning Strategy</div>
                    <div class="menu-desc">ì„ ìˆ˜ë³„ ê³¼ì œ ì§€ì •</div>
                </div>
                <div class="menu-card" data-menu="test">
                    <div class="menu-icon">ğŸƒ</div>
                    <div class="menu-title">Test Result</div>
                    <div class="menu-desc">í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì…ë ¥</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Personal Condition -->
    <div class="screen" id="conditionScreen">
        <div class="sub-header">
            <button class="back-btn">â†</button>
            <div class="sub-title">Personal Condition Check</div>
            <button class="refresh-btn" id="refreshCondition">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                </div>
                <div class="player-select-grid" id="conditionPlayerGrid"></div>
            </div>
            <div id="conditionDataContainer">
                <div class="empty-state">
                    <div class="icon">ğŸ‘¤</div>
                    <div class="text">ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Log -->
    <div class="screen" id="trainingScreen">
        <div class="sub-header">
            <button class="back-btn">â†</button>
            <div class="sub-title">Training Log</div>
            <button class="refresh-btn" id="refreshTraining">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="input">âœï¸ ì…ë ¥</button>
                <button class="tab-btn" data-tab="history">ğŸ“‹ ê¸°ë¡</button>
            </div>
            
            <div id="trainingInputTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                        <span class="card-badge" id="trainingSelectedCount">0ëª… ì„ íƒ</span>
                    </div>
                    <div class="player-select-grid" id="trainingPlayerGrid"></div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-secondary" id="trainingSelectAll" style="padding: 8px 16px; font-size: 13px;">ì „ì²´ ì„ íƒ</button>
                        <button class="btn btn-secondary" id="trainingDeselectAll" style="padding: 8px 16px; font-size: 13px; margin-left: 8px;">ì „ì²´ í•´ì œ</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“ í›ˆë ¨ ì¼ì§€ ì‘ì„±</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">í›ˆë ¨ ë‚ ì§œ</label>
                            <input type="date" class="form-input" id="trainingDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">í›ˆë ¨ ì‹œê° (24ì‹œê°„)</label>
                            <input type="text" class="form-input" id="trainingTime" placeholder="14:30" maxlength="5">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">í›ˆë ¨ ì»¨ì…‰</label>
                            <select class="form-select" id="trainingConcept">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="í•„ë“œí›ˆë ¨">í•„ë“œí›ˆë ¨</option>
                                <option value="ì§í›ˆë ¨">ì§í›ˆë ¨</option>
                                <option value="í•„ë“œ+ì§">í•„ë“œ+ì§</option>
                                <option value="ì „ìˆ í›ˆë ¨">ì „ìˆ í›ˆë ¨</option>
                                <option value="íšŒë³µí›ˆë ¨">íšŒë³µí›ˆë ¨</option>
                                <option value="ê²½ê¸°">ê²½ê¸°</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">í›ˆë ¨ ì‹œê°„ (ë¶„)</label>
                            <input type="number" class="form-input" id="trainingDuration" placeholder="90">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›ˆë ¨ ëª©ì </label>
                        <input type="text" class="form-input" id="trainingPurpose" placeholder="ì˜ˆ: ì²´ë ¥ ê°•í™”, ì „ìˆ  ìˆ™ë‹¬">
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›ˆë ¨ ë‚´ìš©</label>
                        <textarea class="form-textarea" id="trainingContent" placeholder="í›ˆë ¨ ì„¸ë¶€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ“· ì´ë¯¸ì§€ ì²¨ë¶€ (ì„ íƒ)</label>
                        <div class="image-upload-area" id="imageUploadArea">
                            <div class="image-upload-icon">ğŸ“·</div>
                            <div class="image-upload-text">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ</div>
                            <input type="file" id="trainingImage" accept="image/*" style="display: none;">
                        </div>
                        <img id="imagePreview" class="image-preview" style="display: none;">
                    </div>
                    <button class="btn btn-primary btn-full" id="saveTrainingBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="trainingStatus"></div>
                </div>
            </div>
            
            <div id="trainingHistoryTab" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“‹ í›ˆë ¨ ê¸°ë¡</div>
                    </div>
                    <div id="trainingHistoryList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conditioning Strategy -->
    <div class="screen" id="strategyScreen">
        <div class="sub-header">
            <button class="back-btn">â†</button>
            <div class="sub-title">Conditioning Strategy</div>
            <button class="refresh-btn" id="refreshStrategy">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                </div>
                <div class="player-select-grid" id="strategyPlayerGrid"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ¯ ê³¼ì œ ì§€ì •</div>
                </div>
                <div class="form-group">
                    <label class="form-label">ë‚ ì§œ</label>
                    <input type="date" class="form-input" id="strategyDate">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ìˆ˜ë¶„ ì„­ì·¨ (L)</label>
                        <input type="text" class="form-input" id="strategyWater" placeholder="2.0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‹¨ë°±ì§ˆ ì„­ì·¨ (íšŒ)</label>
                        <input type="text" class="form-input" id="strategyProtein" placeholder="3">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì¶”ê°€ ì„­ì·¨</label>
                    <input type="text" class="form-input" id="strategyFood" placeholder="ì˜ˆ: ë°”ë‚˜ë‚˜, ê²¬ê³¼ë¥˜">
                </div>
                <div class="form-group">
                    <label class="form-label">íšŒë³µ ì „ëµ</label>
                    <div class="checkbox-grid">
                        <div class="checkbox-item" data-value="í¼ë¡¤ëŸ¬"><div class="checkbox-box"></div><span class="checkbox-label">í¼ë¡¤ëŸ¬</span></div>
                        <div class="checkbox-item" data-value="ìŠ¤íŠ¸ë ˆì¹­"><div class="checkbox-box"></div><span class="checkbox-label">ìŠ¤íŠ¸ë ˆì¹­</span></div>
                        <div class="checkbox-item" data-value="ë§ˆì‚¬ì§€"><div class="checkbox-box"></div><span class="checkbox-label">ë§ˆì‚¬ì§€</span></div>
                        <div class="checkbox-item" data-value="ëƒ‰ì°œì§ˆ"><div class="checkbox-box"></div><span class="checkbox-label">ëƒ‰ì°œì§ˆ</span></div>
                        <div class="checkbox-item" data-value="ì˜¨ì°œì§ˆ"><div class="checkbox-box"></div><span class="checkbox-label">ì˜¨ì°œì§ˆ</span></div>
                        <div class="checkbox-item" data-value="ì••ë°•ì˜ë¥˜"><div class="checkbox-box"></div><span class="checkbox-label">ì••ë°•ì˜ë¥˜</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ë³´ì¶© í›ˆë ¨</label>
                    <textarea class="form-textarea" id="strategyExercise" placeholder="ì˜ˆ: ì½”ì–´ ìš´ë™ 20ë¶„, ë°´ë“œ ìŠ¤íŠ¸ë ˆì¹­"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ì˜ìƒ ë§í¬ (ì„ íƒ)</label>
                    <input type="text" class="form-input" id="strategyVideoLink" placeholder="https://youtube.com/...">
                </div>
                <button class="btn btn-primary btn-full" id="saveStrategyBtn">ì €ì¥í•˜ê¸°</button>
                <div id="strategyStatus"></div>
            </div>
        </div>
    </div>

    <!-- Test Result -->
    <div class="screen" id="testScreen">
        <div class="sub-header">
            <button class="back-btn">â†</button>
            <div class="sub-title">Test Result & Analysis</div>
            <button class="refresh-btn" id="refreshTest">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                </div>
                <div class="player-select-grid" id="testPlayerGrid"></div>
            </div>
            
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="inbody">ğŸ“Š ì¸ë°”ë””</button>
                <button class="tab-btn" data-tab="fms">ğŸ¤¸ FMS</button>
                <button class="tab-btn" data-tab="running">ğŸƒ ëŸ°ë‹</button>
            </div>
            
            <div id="inbodyTab">
                <div class="card">
                    <div class="card-header"><div class="card-title">ğŸ“Š ì¸ë°”ë”” ì¸¡ì •</div></div>
                    <div class="form-group">
                        <label class="form-label">ì¸¡ì • ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="inbodyDate">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì‹ ì¥ (cm)</label>
                            <input type="number" class="form-input" id="inbodyHeight" placeholder="175">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì²´ì¤‘ (kg)</label>
                            <input type="number" class="form-input" id="inbodyWeight" placeholder="70" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì²´ì§€ë°©ëŸ‰ (kg)</label>
                            <input type="number" class="form-input" id="inbodyFatMass" placeholder="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì²´ì§€ë°©ë¥  (%)</label>
                            <input type="number" class="form-input" id="inbodyFatPercent" placeholder="14" step="0.1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê³¨ê²©ê·¼ëŸ‰ (kg)</label>
                        <input type="number" class="form-input" id="inbodyMuscle" placeholder="35" step="0.1">
                    </div>
                    <button class="btn btn-primary btn-full" id="saveInbodyBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="inbodyStatus"></div>
                </div>
            </div>
            
            <div id="fmsTab" style="display: none;">
                <div class="card">
                    <div class="card-header"><div class="card-title">ğŸ¤¸ FMS ì¸¡ì •</div></div>
                    <div class="form-group">
                        <label class="form-label">ì¸¡ì • ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="fmsDate">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Deep Squat</label>
                            <input type="number" class="form-input" id="fmsDeepSquat" placeholder="0-3" min="0" max="3">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hurdle Step</label>
                            <input type="number" class="form-input" id="fmsHurdleStep" placeholder="0-3" min="0" max="3">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Inline Lunge</label>
                            <input type="number" class="form-input" id="fmsInlineLunge" placeholder="0-3" min="0" max="3">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shoulder Mobility</label>
                            <input type="number" class="form-input" id="fmsShoulderMob" placeholder="0-3" min="0" max="3">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ASLR</label>
                            <input type="number" class="form-input" id="fmsASLR" placeholder="0-3" min="0" max="3">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Trunk Stability</label>
                            <input type="number" class="form-input" id="fmsTrunkStability" placeholder="0-3" min="0" max="3">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rotary Stability</label>
                        <input type="number" class="form-input" id="fmsRotaryStability" placeholder="0-3" min="0" max="3">
                    </div>
                    <button class="btn btn-primary btn-full" id="saveFmsBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="fmsStatus"></div>
                </div>
            </div>
            
            <div id="runningTab" style="display: none;">
                <div class="card">
                    <div class="card-header"><div class="card-title">ğŸƒ ëŸ°ë‹ í…ŒìŠ¤íŠ¸</div></div>
                    <div class="form-group">
                        <label class="form-label">ì¸¡ì • ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="runningDate">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">MAS (km/h)</label>
                            <input type="number" class="form-input" id="runningMAS" placeholder="15.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Velocity (km/h)</label>
                            <input type="number" class="form-input" id="runningMaxVel" placeholder="30.0" step="0.1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">VO2max</label>
                        <input type="number" class="form-input" id="runningVO2max" placeholder="55.0" step="0.1">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">10m Sprint (ì´ˆ)</label>
                            <input type="number" class="form-input" id="sprint10m" placeholder="1.80" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">30m Sprint (ì´ˆ)</label>
                            <input type="number" class="form-input" id="sprint30m" placeholder="4.20" step="0.01">
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" id="saveRunningBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="runningStatus"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script>
    // =====================================================
    // Firebase ì„¤ì •
    // =====================================================
    const firebaseConfig = {
        apiKey: "AIzaSyDhwvdHmU9tfwZVNHosFIeCVz-ejoWvQgU",
        authDomain: "stribe-management.firebaseapp.com",
        projectId: "stribe-management",
        storageBucket: "stribe-management.firebasestorage.app",
        messagingSenderId: "169343581314",
        appId: "1:169343581314:web:5abfafa5bd6c98bc81c89b"
    };

    // Firebase ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // =====================================================
    // ì „ì—­ ë³€ìˆ˜
    // =====================================================
    const COACHES = [
        { id: "coach", pw: "1234", name: "ì½”ì¹˜" },
        { id: "admin", pw: "admin", name: "ê´€ë¦¬ì" }
    ];

    let currentCoach = null;
    let players = [];
    let currentSelectedPlayer = null;
    let selectedImageFile = null;

    // =====================================================
    // ì´ˆê¸°í™”
    // =====================================================
    document.addEventListener('DOMContentLoaded', function() {
        initDate();
        loadPlayers();
        setupEventListeners();
    });

    function initDate() {
        const today = new Date();
        const dateStr = today.toLocaleDateString('ko-KR', { 
            year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' 
        });
        document.getElementById('todayDate').textContent = dateStr;
        
        const isoDate = today.toISOString().split('T')[0];
        document.getElementById('strategyDate').value = isoDate;
        document.getElementById('inbodyDate').value = isoDate;
        document.getElementById('fmsDate').value = isoDate;
        document.getElementById('runningDate').value = isoDate;
        document.getElementById('trainingDate').value = isoDate;
        
        const hours = String(today.getHours()).padStart(2, '0');
        const minutes = String(today.getMinutes()).padStart(2, '0');
        document.getElementById('trainingTime').value = hours + ':' + minutes;
    }

    // =====================================================
    // Firebase - ì„ ìˆ˜ ëª©ë¡ ë¡œë“œ
    // =====================================================
    async function loadPlayers() {
        try {
            const snapshot = await db.collection('players').orderBy('name').get();
            players = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));
            renderPlayerGrids();
        } catch (error) {
            console.error('ì„ ìˆ˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            players = [];
            renderPlayerGrids();
        }
    }

    function renderPlayerGrids() {
        const grids = ['conditionPlayerGrid', 'strategyPlayerGrid', 'testPlayerGrid', 'trainingPlayerGrid'];
        grids.forEach(gridId => {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            
            if (players.length === 0) {
                grid.innerHTML = '<div style="color: #64748b; text-align: center; padding: 20px;">ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            grid.innerHTML = players.map(p => {
                let birthDisplay = '';
                if (p.birthdate) {
                    let birthStr = String(p.birthdate).trim();
                    if (/^\d{5,6}$/.test(birthStr)) {
                        if (birthStr.length === 5) birthStr = '0' + birthStr;
                        birthDisplay = `${birthStr.slice(0, 2)}.${birthStr.slice(2, 4)}.${birthStr.slice(4, 6)}`;
                    } else {
                        birthDisplay = birthStr;
                    }
                }
                return `
                <div class="player-chip" data-player="${p.name}" data-birth="${p.birthdate || ''}" data-id="${p.id}">
                    <div class="name">${p.name}</div>
                    <div class="birth">${birthDisplay}</div>
                </div>
            `}).join('');
            
            grid.querySelectorAll('.player-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    if (gridId === 'trainingPlayerGrid') {
                        this.classList.toggle('selected');
                        updateTrainingSelectedCount();
                    } else {
                        grid.querySelectorAll('.player-chip').forEach(c => c.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        if (gridId === 'conditionPlayerGrid') {
                            currentSelectedPlayer = this.dataset.player;
                            loadConditionData(currentSelectedPlayer);
                        }
                    }
                });
            });
        });
    }

    function updateTrainingSelectedCount() {
        const grid = document.getElementById('trainingPlayerGrid');
        if (!grid) return;
        const count = grid.querySelectorAll('.player-chip.selected').length;
        document.getElementById('trainingSelectedCount').textContent = count + 'ëª… ì„ íƒ';
    }

    function getTrainingSelectedPlayers() {
        const grid = document.getElementById('trainingPlayerGrid');
        if (!grid) return [];
        return Array.from(grid.querySelectorAll('.player-chip.selected')).map(chip => ({
            name: chip.dataset.player,
            birth: chip.dataset.birth,
            id: chip.dataset.id
        }));
    }

    // =====================================================
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    // =====================================================
    function setupEventListeners() {
        // ë¡œê·¸ì¸
        document.getElementById('loginBtn').addEventListener('click', handleLogin);
        document.getElementById('loginPw').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleLogin();
        });
        
        // ë¡œê·¸ì•„ì›ƒ
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        
        // ë©”ë‰´ ì¹´ë“œ
        document.querySelectorAll('.menu-card').forEach(card => {
            card.addEventListener('click', function() {
                const menu = this.dataset.menu;
                showScreen(menu + 'Screen');
            });
        });
        
        // ë’¤ë¡œê°€ê¸°
        document.querySelectorAll('.back-btn').forEach(btn => {
            btn.addEventListener('click', () => showScreen('mainScreen'));
        });
        
        // íƒ­ ì „í™˜
        setupTabNavigation();
        
        // ì²´í¬ë°•ìŠ¤ í† ê¸€
        document.querySelectorAll('.checkbox-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                this.classList.toggle('checked');
            });
        });
        
        // ì €ì¥ ë²„íŠ¼ë“¤
        document.getElementById('saveTrainingBtn').addEventListener('click', saveTrainingLog);
        document.getElementById('saveStrategyBtn').addEventListener('click', saveStrategy);
        document.getElementById('saveInbodyBtn').addEventListener('click', () => saveTestResult('inbody'));
        document.getElementById('saveFmsBtn').addEventListener('click', () => saveTestResult('fms'));
        document.getElementById('saveRunningBtn').addEventListener('click', () => saveTestResult('running'));
        
        // í›ˆë ¨ ë¡œê·¸ ì„ ìˆ˜ ì „ì²´ ì„ íƒ/í•´ì œ
        document.getElementById('trainingSelectAll').addEventListener('click', function() {
            document.querySelectorAll('#trainingPlayerGrid .player-chip').forEach(chip => chip.classList.add('selected'));
            updateTrainingSelectedCount();
        });
        
        document.getElementById('trainingDeselectAll').addEventListener('click', function() {
            document.querySelectorAll('#trainingPlayerGrid .player-chip').forEach(chip => chip.classList.remove('selected'));
            updateTrainingSelectedCount();
        });
        
        // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ë“¤
        document.getElementById('refreshCondition').addEventListener('click', () => {
            loadPlayers();
            if (currentSelectedPlayer) loadConditionData(currentSelectedPlayer);
        });
        document.getElementById('refreshTraining').addEventListener('click', () => {
            loadPlayers();
            loadTrainingHistory();
        });
        document.getElementById('refreshStrategy').addEventListener('click', loadPlayers);
        document.getElementById('refreshTest').addEventListener('click', loadPlayers);
        
        // í›ˆë ¨ ì‹œê° ìë™ í¬ë§·íŒ…
        document.getElementById('trainingTime').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + ':' + value.slice(2, 4);
            }
            e.target.value = value.slice(0, 5);
        });
        
        // ì´ë¯¸ì§€ ì—…ë¡œë“œ
        const uploadArea = document.getElementById('imageUploadArea');
        const imageInput = document.getElementById('trainingImage');
        
        uploadArea.addEventListener('click', function(e) {
            const input = document.getElementById('trainingImage');
            if (input) input.click();
        });
        imageInput.addEventListener('change', handleImageSelect);
    }

    function setupTabNavigation() {
        document.querySelectorAll('.tab-nav').forEach(nav => {
            nav.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    nav.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tab = this.dataset.tab;
                    const screen = nav.closest('.screen');
                    
                    if (screen.id === 'trainingScreen') {
                        document.getElementById('trainingInputTab').style.display = tab === 'input' ? 'block' : 'none';
                        document.getElementById('trainingHistoryTab').style.display = tab === 'history' ? 'block' : 'none';
                        if (tab === 'history') loadTrainingHistory();
                    }
                    
                    if (screen.id === 'testScreen') {
                        document.getElementById('inbodyTab').style.display = tab === 'inbody' ? 'block' : 'none';
                        document.getElementById('fmsTab').style.display = tab === 'fms' ? 'block' : 'none';
                        document.getElementById('runningTab').style.display = tab === 'running' ? 'block' : 'none';
                    }
                });
            });
        });
    }

    // =====================================================
    // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
    // =====================================================
    function handleLogin() {
        const id = document.getElementById('loginId').value.trim();
        const pw = document.getElementById('loginPw').value;
        const errorMsg = document.getElementById('errorMsg');
        
        const coach = COACHES.find(c => c.id === id && c.pw === pw);
        
        if (coach) {
            currentCoach = coach;
            showScreen('mainScreen');
            errorMsg.style.display = 'none';
        } else {
            errorMsg.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
            errorMsg.style.display = 'block';
        }
    }

    function handleLogout() {
        currentCoach = null;
        showScreen('loginScreen');
        document.getElementById('loginId').value = '';
        document.getElementById('loginPw').value = '';
    }

    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }

    // =====================================================
    // Firebase - ì»¨ë””ì…˜ ë°ì´í„° ë¡œë“œ
    // =====================================================
    async function loadConditionData(playerName) {
        const container = document.getElementById('conditionDataContainer');
        
        if (!playerName) {
            container.innerHTML = `<div class="empty-state"><div class="icon">ğŸ‘¤</div><div class="text">ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div></div>`;
            return;
        }
        
        container.innerHTML = `<div class="loading"><div class="loading-spinner"></div><div>ë°ì´í„° ë¡œë”© ì¤‘...</div></div>`;
        
        // ìµœê·¼ 6ì¼
        const dates = [];
        const today = new Date();
        for (let i = 6; i >= 1; i--) {
            const d = new Date(today);
            d.setDate(d.getDate() - i);
            const dateStr = d.toISOString().split('T')[0];
            dates.push({
                label: `${d.getMonth()+1}/${d.getDate()}`,
                date: dateStr,
                display: d.toLocaleDateString('ko-KR', { weekday: 'short' })
            });
        }
        
        try {
            const snapshot = await db.collection('conditions')
                .where('player', '==', playerName)
                .where('date', '>=', dates[0].date)
                .where('date', '<=', dates[5].date)
                .get();
            
            const data = snapshot.docs.map(doc => doc.data());
            renderConditionTable(playerName, dates, data);
        } catch (error) {
            console.error('ì»¨ë””ì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            container.innerHTML = `<div class="empty-state"><div class="icon">âš ï¸</div><div class="text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div></div>`;
        }
    }

    function renderConditionTable(playerName, dates, data) {
        const container = document.getElementById('conditionDataContainer');
        
        const dataByDate = {};
        data.forEach(d => { dataByDate[d.date] = d; });
        
        const formatTime = (val) => {
            if (!val) return null;
            const str = String(val);
            if (/^\d{1,2}:\d{2}$/.test(str)) return str;
            if (str.includes('T')) return str.split('T')[1].substring(0, 5);
            return str;
        };
        
        const getValue = (date, field) => {
            const d = dataByDate[date];
            if (!d) return '<span class="no-data">-</span>';
            const val = d[field];
            if (val === undefined || val === null || val === '') return '<span class="no-data">-</span>';
            if (field === 'breakfast' || field === 'lunch' || field === 'dinner') {
                return formatTime(val) || '<span class="no-data">-</span>';
            }
            return String(val);
        };
        
        const getRpeValue = (date) => {
            const d = dataByDate[date];
            if (!d || !d.rpe) return '<span class="no-data">-</span>';
            const rpe = parseInt(d.rpe);
            const rpeClass = rpe <= 4 ? 'rpe-low' : (rpe <= 7 ? 'rpe-mid' : 'rpe-high');
            return `<span class="rpe-cell ${rpeClass}">${rpe}</span>`;
        };
        
        let html = `
        <div class="card" style="padding: 15px;">
            <div class="card-header">
                <div class="card-title">ğŸ“Š ${playerName} - ìµœê·¼ 6ì¼ ì»¨ë””ì…˜</div>
            </div>
            <div class="condition-table-wrapper">
                <table class="condition-table">
                    <thead>
                        <tr>
                            <th colspan="2"></th>
                            ${dates.map(d => `<th>${d.label}<br><small>${d.display}</small></th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="category-group" rowspan="5">ğŸ¥— ì˜ì–‘</td>
                            <td class="category-cell">ì•„ì¹¨</td>
                            ${dates.map(d => `<td>${getValue(d.date, 'breakfast')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">ì ì‹¬</td>
                            ${dates.map(d => `<td>${getValue(d.date, 'lunch')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">ì €ë…</td>
                            ${dates.map(d => `<td>${getValue(d.date, 'dinner')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">ë‹¨ë°±ì§ˆ</td>
                            ${dates.map(d => {
                                const val = getValue(d.date, 'protein');
                                return `<td>${val !== '<span class="no-data">-</span>' ? val + 'íšŒ' : val}</td>`;
                            }).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">ìˆ˜ë¶„</td>
                            ${dates.map(d => {
                                const val = getValue(d.date, 'water');
                                return `<td>${val !== '<span class="no-data">-</span>' ? val + 'L' : val}</td>`;
                            }).join('')}
                        </tr>
                        <tr>
                            <td class="category-group" rowspan="2">ğŸ©¹ íšŒë³µ</td>
                            <td class="category-cell">ë¶€ìƒ/í†µì¦</td>
                            ${dates.map(d => `<td>${getValue(d.date, 'injury')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">íšŒë³µì „ëµ</td>
                            ${dates.map(d => `<td>${getValue(d.date, 'recovery')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-group" rowspan="4">ğŸ’ª í›ˆë ¨</td>
                            <td class="category-cell">ì»¨ì…‰</td>
                            ${dates.map(d => `<td>${getValue(d.date, 'trainingConcept')}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">ì‹œê°„</td>
                            ${dates.map(d => {
                                const val = getValue(d.date, 'trainingTime');
                                return `<td>${val !== '<span class="no-data">-</span>' ? val + 'ë¶„' : val}</td>`;
                            }).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">RPE</td>
                            ${dates.map(d => `<td>${getRpeValue(d.date)}</td>`).join('')}
                        </tr>
                        <tr>
                            <td class="category-cell">í›ˆë ¨ë¶€í•˜</td>
                            ${dates.map(d => {
                                const dayData = dataByDate[d.date];
                                if (dayData && dayData.rpe && dayData.trainingTime) {
                                    const rpe = parseFloat(dayData.rpe);
                                    const time = parseFloat(dayData.trainingTime);
                                    if (!isNaN(rpe) && !isNaN(time)) {
                                        return `<td>${rpe * time}</td>`;
                                    }
                                }
                                return '<td><span class="no-data">-</span></td>';
                            }).join('')}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>`;
        
        container.innerHTML = html;
    }

    // =====================================================
    // Firebase - í›ˆë ¨ ì¼ì§€ ì €ì¥
    // =====================================================
    async function saveTrainingLog() {
        const btn = document.getElementById('saveTrainingBtn');
        const status = document.getElementById('trainingStatus');
        
        const selectedPlayers = getTrainingSelectedPlayers();
        
        if (selectedPlayers.length === 0) {
            showStatus(status, 'ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        const trainingDate = document.getElementById('trainingDate').value;
        const trainingTime = document.getElementById('trainingTime').value;
        const concept = document.getElementById('trainingConcept').value;
        const duration = document.getElementById('trainingDuration').value;
        const purpose = document.getElementById('trainingPurpose').value;
        const content = document.getElementById('trainingContent').value;
        
        if (!trainingDate || !trainingTime || !concept || !duration) {
            showStatus(status, 'í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        btn.disabled = true;
        btn.textContent = 'ì €ì¥ ì¤‘...';
        
        try {
            let imageUrl = '';
            
            // ì´ë¯¸ì§€ ì—…ë¡œë“œ
            if (selectedImageFile) {
                const fileName = `training/${Date.now()}_${selectedImageFile.name}`;
                const storageRef = storage.ref(fileName);
                await storageRef.put(selectedImageFile);
                imageUrl = await storageRef.getDownloadURL();
            }
            
            const datetime = trainingDate + 'T' + trainingTime;
            const batch = db.batch();
            
            // ê° ì„ ìˆ˜ë³„ë¡œ ì €ì¥
            selectedPlayers.forEach(player => {
                const docRef = db.collection('trainingLogs').doc();
                batch.set(docRef, {
                    datetime: datetime,
                    concept: concept,
                    duration: parseInt(duration),
                    purpose: purpose,
                    content: content,
                    imageUrl: imageUrl,
                    playerName: player.name,
                    playerBirth: player.birth,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            });
            
            await batch.commit();
            
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, `âœ“ ${selectedPlayers.length}ëª…ì˜ í›ˆë ¨ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            clearTrainingForm();
            
        } catch (error) {
            console.error('ì €ì¥ ì‹¤íŒ¨:', error);
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
        }
    }

    function clearTrainingForm() {
        document.getElementById('trainingConcept').value = '';
        document.getElementById('trainingDuration').value = '';
        document.getElementById('trainingPurpose').value = '';
        document.getElementById('trainingContent').value = '';
        document.querySelectorAll('#trainingPlayerGrid .player-chip').forEach(chip => chip.classList.remove('selected'));
        updateTrainingSelectedCount();
        
        // ì´ë¯¸ì§€ ì´ˆê¸°í™”
        selectedImageFile = null;
        const preview = document.getElementById('imagePreview');
        if (preview) preview.style.display = 'none';
        
        const imageInput = document.getElementById('trainingImage');
        if (imageInput) imageInput.value = '';
        
        const uploadArea = document.getElementById('imageUploadArea');
        if (uploadArea) {
            uploadArea.classList.remove('has-image');
            // input ìš”ì†ŒëŠ” ìœ ì§€í•˜ê³  í…ìŠ¤íŠ¸ë§Œ ë³€ê²½
            const existingInput = uploadArea.querySelector('input[type="file"]');
            uploadArea.innerHTML = '<div class="image-upload-icon">ğŸ“·</div><div class="image-upload-text">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ</div>';
            // input ë‹¤ì‹œ ì¶”ê°€
            const newInput = document.createElement('input');
            newInput.type = 'file';
            newInput.id = 'trainingImage';
            newInput.accept = 'image/*';
            newInput.style.display = 'none';
            newInput.addEventListener('change', handleImageSelect);
            uploadArea.appendChild(newInput);
        }
    }
    
    function handleImageSelect(e) {
        const file = e.target.files[0];
        if (file) {
            selectedImageFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('imagePreview');
                preview.src = e.target.result;
                preview.style.display = 'block';
                const uploadArea = document.getElementById('imageUploadArea');
                uploadArea.classList.add('has-image');
                uploadArea.querySelector('.image-upload-icon').style.display = 'none';
                uploadArea.querySelector('.image-upload-text').textContent = 'âœ“ ì´ë¯¸ì§€ ì„ íƒë¨ (í´ë¦­í•˜ì—¬ ë³€ê²½)';
            };
            reader.readAsDataURL(file);
        }
    }

    // =====================================================
    // Firebase - í›ˆë ¨ ê¸°ë¡ ì¡°íšŒ
    // =====================================================
    async function loadTrainingHistory() {
        const container = document.getElementById('trainingHistoryList');
        container.innerHTML = `<div class="loading"><div class="loading-spinner"></div><div>ë°ì´í„° ë¡œë”© ì¤‘...</div></div>`;
        
        try {
            const snapshot = await db.collection('trainingLogs')
                .orderBy('createdAt', 'desc')
                .limit(20)
                .get();
            
            const logs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><div class="text">í›ˆë ¨ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div></div>';
                return;
            }
            
            // ë‚ ì§œ+ì‹œê°„ë³„ë¡œ ê·¸ë£¹í•‘
            const grouped = {};
            logs.forEach(log => {
                const key = log.datetime;
                if (!grouped[key]) grouped[key] = { ...log, players: [] };
                grouped[key].players.push(log.playerName);
            });
            
            let html = '';
            Object.values(grouped).forEach(log => {
                const date = log.datetime ? log.datetime.split('T')[0] : '';
                const time = log.datetime ? log.datetime.split('T')[1] : '';
                
                html += `
                <div style="background: #0f172a; border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #3b82f6; font-weight: 600;">${log.concept || 'í›ˆë ¨'}</span>
                        <span style="color: #64748b; font-size: 13px;">${date} ${time}</span>
                    </div>
                    <div style="color: #94a3b8; font-size: 13px; margin-bottom: 8px;">
                        â±ï¸ ${log.duration}ë¶„ | ğŸ‘¥ ${log.players.join(', ')}
                    </div>
                    ${log.purpose ? `<div style="color: #e2e8f0; font-size: 14px; margin-bottom: 6px;"><strong>ëª©ì :</strong> ${log.purpose}</div>` : ''}
                    ${log.content ? `<div style="color: #e2e8f0; font-size: 14px;"><strong>ë‚´ìš©:</strong> ${log.content}</div>` : ''}
                    ${log.imageUrl ? `<img src="${log.imageUrl}" style="max-width: 100%; border-radius: 8px; margin-top: 10px;">` : ''}
                </div>`;
            });
            
            container.innerHTML = html;
            
        } catch (error) {
            console.error('í›ˆë ¨ ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            container.innerHTML = '<div class="empty-state"><div class="icon">âš ï¸</div><div class="text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div></div>';
        }
    }

    // =====================================================
    // Firebase - ê³¼ì œ ì €ì¥
    // =====================================================
    async function saveStrategy() {
        const selectedPlayer = document.querySelector('#strategyPlayerGrid .player-chip.selected');
        const btn = document.getElementById('saveStrategyBtn');
        const status = document.getElementById('strategyStatus');
        
        if (!selectedPlayer) {
            showStatus(status, 'ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        const recoveryMethods = Array.from(document.querySelectorAll('#strategyScreen .checkbox-item.checked'))
            .map(item => item.dataset.value);
        
        const data = {
            player: selectedPlayer.dataset.player,
            playerBirth: selectedPlayer.dataset.birth,
            date: document.getElementById('strategyDate').value,
            water: document.getElementById('strategyWater').value,
            protein: document.getElementById('strategyProtein').value,
            food: document.getElementById('strategyFood').value,
            recovery: recoveryMethods.join(', '),
            exercise: document.getElementById('strategyExercise').value,
            videoLink: document.getElementById('strategyVideoLink').value,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        btn.disabled = true;
        btn.textContent = 'ì €ì¥ ì¤‘...';
        
        try {
            // ê°™ì€ ë‚ ì§œ, ê°™ì€ ì„ ìˆ˜ì˜ ê¸°ì¡´ ê³¼ì œ í™•ì¸
            const existing = await db.collection('tasks')
                .where('player', '==', data.player)
                .where('date', '==', data.date)
                .get();
            
            if (!existing.empty) {
                // ê¸°ì¡´ ê³¼ì œ ì—…ë°ì´íŠ¸
                await existing.docs[0].ref.update(data);
            } else {
                // ìƒˆ ê³¼ì œ ì¶”ê°€
                await db.collection('tasks').add(data);
            }
            
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
        } catch (error) {
            console.error('ê³¼ì œ ì €ì¥ ì‹¤íŒ¨:', error);
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
        }
    }

    // =====================================================
    // Firebase - í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥
    // =====================================================
    async function saveTestResult(type) {
        const selectedPlayer = document.querySelector('#testPlayerGrid .player-chip.selected');
        let btn, status, data;
        
        if (!selectedPlayer) {
            const statusEl = document.getElementById(type + 'Status');
            showStatus(statusEl, 'ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        const baseData = {
            type: type,
            player: selectedPlayer.dataset.player,
            playerBirth: selectedPlayer.dataset.birth,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (type === 'inbody') {
            btn = document.getElementById('saveInbodyBtn');
            status = document.getElementById('inbodyStatus');
            data = {
                ...baseData,
                date: document.getElementById('inbodyDate').value,
                height: document.getElementById('inbodyHeight').value,
                weight: document.getElementById('inbodyWeight').value,
                fatMass: document.getElementById('inbodyFatMass').value,
                fatPercent: document.getElementById('inbodyFatPercent').value,
                muscle: document.getElementById('inbodyMuscle').value
            };
        } else if (type === 'fms') {
            btn = document.getElementById('saveFmsBtn');
            status = document.getElementById('fmsStatus');
            const scores = {
                deepSquat: parseInt(document.getElementById('fmsDeepSquat').value) || 0,
                hurdleStep: parseInt(document.getElementById('fmsHurdleStep').value) || 0,
                inlineLunge: parseInt(document.getElementById('fmsInlineLunge').value) || 0,
                shoulderMob: parseInt(document.getElementById('fmsShoulderMob').value) || 0,
                aslr: parseInt(document.getElementById('fmsASLR').value) || 0,
                trunkStability: parseInt(document.getElementById('fmsTrunkStability').value) || 0,
                rotaryStability: parseInt(document.getElementById('fmsRotaryStability').value) || 0
            };
            data = {
                ...baseData,
                date: document.getElementById('fmsDate').value,
                ...scores,
                total: Object.values(scores).reduce((a, b) => a + b, 0)
            };
        } else if (type === 'running') {
            btn = document.getElementById('saveRunningBtn');
            status = document.getElementById('runningStatus');
            data = {
                ...baseData,
                date: document.getElementById('runningDate').value,
                mas: document.getElementById('runningMAS').value,
                maxVel: document.getElementById('runningMaxVel').value,
                vo2max: document.getElementById('runningVO2max').value,
                sprint10m: document.getElementById('sprint10m').value,
                sprint30m: document.getElementById('sprint30m').value
            };
        }
        
        btn.disabled = true;
        btn.textContent = 'ì €ì¥ ì¤‘...';
        
        try {
            await db.collection('testResults').add(data);
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        } catch (error) {
            console.error('í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:', error);
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
        }
    }

    // =====================================================
    // ìœ í‹¸ë¦¬í‹°
    // =====================================================
    function showStatus(element, message, type) {
        element.innerHTML = `<div class="status-msg status-${type}">${message}</div>`;
        setTimeout(() => { element.innerHTML = ''; }, 3000);
    }
    </script>
</body>
</html>
