<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Stribe Coach</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f172a; min-height: 100vh; color: #e2e8f0; }
        
        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        .screen { display: none; min-height: 100vh; }
        .screen.active { display: block; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-wrapper { min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; background: linear-gradient(135deg, #1e3a5f, #0f172a); }
        .login-container { background: rgba(30, 41, 59, 0.95); border: 1px solid #334155; border-radius: 20px; padding: 40px 30px; width: 100%; max-width: 380px; backdrop-filter: blur(10px); }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo span { font-size: 50px; }
        .logo h1 { font-size: 26px; color: #f1f5f9; margin-top: 10px; font-weight: 700; }
        .logo p { font-size: 14px; color: #64748b; margin-top: 5px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; color: #94a3b8; font-size: 14px; margin-bottom: 8px; font-weight: 500; }
        .input-group input { width: 100%; padding: 14px 16px; border: 1px solid #334155; border-radius: 12px; font-size: 16px; background: #1e293b; color: #f1f5f9; transition: all 0.2s; }
        .input-group input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .login-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .login-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .error-msg { color: #f87171; text-align: center; margin-top: 15px; font-size: 14px; display: none; }
        
        /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ */
        .dashboard { padding: 20px; padding-top: 30px; max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .header-title { font-size: 24px; font-weight: 700; color: #f1f5f9; }
        .header-date { font-size: 13px; color: #64748b; margin-top: 4px; }
        .logout-btn { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; color: #f87171; padding: 8px 16px; border-radius: 8px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .logout-btn:hover { background: rgba(239, 68, 68, 0.3); }
        
        /* ë©”ë‰´ ê·¸ë¦¬ë“œ */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .menu-card { background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 16px; padding: 24px 20px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .menu-card:hover { transform: translateY(-2px); border-color: #3b82f6; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2); }
        .menu-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3b82f6, #8b5cf6); opacity: 0; transition: opacity 0.3s; }
        .menu-card:hover::before { opacity: 1; }
        .menu-icon { font-size: 32px; margin-bottom: 12px; }
        .menu-title { font-size: 16px; font-weight: 600; color: #f1f5f9; margin-bottom: 6px; }
        .menu-desc { font-size: 12px; color: #64748b; line-height: 1.4; }
        
        /* ì„œë¸Œ í˜ì´ì§€ í—¤ë” */
        .sub-header { background: linear-gradient(135deg, #1e293b, #0f172a); padding: 20px; padding-top: 50px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 100; }
        .back-btn { background: none; border: none; font-size: 24px; color: #94a3b8; cursor: pointer; padding: 5px; }
        .sub-title { font-size: 20px; font-weight: 700; color: #f1f5f9; }
        .sub-content { padding: 20px; padding-bottom: 100px; max-width: 800px; margin: 0 auto; }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { padding: 10px 18px; background: #1e293b; border: 1px solid #334155; border-radius: 10px; color: #94a3b8; font-size: 14px; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
        .tab-btn.active { background: #3b82f6; border-color: #3b82f6; color: white; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 16px; padding: 20px; margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #334155; }
        .card-title { font-size: 16px; font-weight: 600; color: #f1f5f9; display: flex; align-items: center; gap: 8px; }
        .card-badge { background: #3b82f6; color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        
        /* ì„ ìˆ˜ ì„ íƒ */
        .player-select-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .player-chip { padding: 12px 16px; background: #0f172a; border: 1px solid #334155; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .player-chip:hover { border-color: #3b82f6; }
        .player-chip.selected { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .player-chip .name { font-size: 14px; font-weight: 600; color: #f1f5f9; }
        .player-chip .pos { font-size: 11px; color: #64748b; margin-top: 2px; }
        
        /* í¼ ìš”ì†Œ */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; color: #94a3b8; margin-bottom: 8px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 14px 16px; background: #0f172a; border: 1px solid #334155; border-radius: 10px; font-size: 15px; color: #f1f5f9; transition: all 0.2s; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .form-textarea { min-height: 120px; resize: vertical; font-family: inherit; }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .form-row-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        
        /* ì²´í¬ë°•ìŠ¤ ê·¸ë¦¬ë“œ */
        .checkbox-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: #0f172a; border: 1px solid #334155; border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .checkbox-item:hover { border-color: #3b82f6; }
        .checkbox-item.checked { background: rgba(59, 130, 246, 0.15); border-color: #3b82f6; }
        .checkbox-item input { display: none; }
        .checkbox-box { width: 20px; height: 20px; border: 2px solid #475569; border-radius: 5px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .checkbox-item.checked .checkbox-box { background: #3b82f6; border-color: #3b82f6; }
        .checkbox-item.checked .checkbox-box::after { content: 'âœ“'; color: white; font-size: 12px; }
        .checkbox-label { font-size: 14px; color: #e2e8f0; }
        
        /* ë²„íŠ¼ */
        .btn { padding: 14px 24px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .btn-secondary { background: #334155; color: #f1f5f9; }
        .btn-full { width: 100%; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        
        /* ë°ì´í„° í…Œì´ë¸” */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #334155; }
        .data-table th { background: #0f172a; color: #94a3b8; font-size: 13px; font-weight: 600; }
        .data-table td { color: #e2e8f0; font-size: 14px; }
        .data-table tr:hover td { background: rgba(59, 130, 246, 0.05); }
        
        /* ì»¨ë””ì…˜ ì¹´ë“œ */
        .condition-card { background: #0f172a; border: 1px solid #334155; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .condition-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .condition-player { font-size: 16px; font-weight: 600; color: #f1f5f9; }
        .condition-date { font-size: 12px; color: #64748b; }
        .condition-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .condition-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #1e293b; }
        .condition-item:last-child { border-bottom: none; }
        .condition-label { font-size: 13px; color: #94a3b8; }
        .condition-value { font-size: 13px; font-weight: 500; color: #f1f5f9; }
        
        /* RPE ë°°ì§€ */
        .rpe-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .rpe-low { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .rpe-mid { background: rgba(234, 179, 8, 0.2); color: #facc15; }
        .rpe-high { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        
        /* ë‚ ì§œ í•„í„° */
        .date-filter { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
        .date-filter input[type="date"] { padding: 10px 14px; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: #f1f5f9; font-size: 14px; }
        
        /* ë¡œë”© */
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid #334155; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ìƒíƒœ ë©”ì‹œì§€ */
        .status-msg { text-align: center; padding: 15px; font-size: 14px; border-radius: 10px; margin-top: 15px; }
        .status-success { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .status-error { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state { text-align: center; padding: 60px 20px; color: #64748b; }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; opacity: 0.5; }
        .empty-state .text { font-size: 15px; }
        
        /* í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¹´ë“œ */
        .test-card { background: #0f172a; border: 1px solid #334155; border-radius: 12px; padding: 16px; margin-bottom: 15px; }
        .test-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .test-title { font-size: 15px; font-weight: 600; color: #f1f5f9; }
        .test-value-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .test-value-item { background: #1e293b; padding: 12px; border-radius: 8px; }
        .test-value-label { font-size: 12px; color: #64748b; margin-bottom: 4px; }
        .test-value-num { font-size: 18px; font-weight: 700; color: #3b82f6; }
        .test-value-unit { font-size: 12px; color: #94a3b8; margin-left: 2px; }
        /* 7ì¼ ì»¨ë””ì…˜ í…Œì´ë¸” */
        .condition-table-wrapper { overflow-x: auto; margin-top: 15px; }
        .condition-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        .condition-table th, .condition-table td { padding: 10px 6px; text-align: center; border: 1px solid #334155; font-size: 13px; overflow: hidden; text-overflow: ellipsis; }
        .condition-table th { background: #0f172a; color: #94a3b8; font-weight: 600; white-space: nowrap; }
        .condition-table th.day-header { background: linear-gradient(135deg, #1e3a5f, #0f172a); color: #f1f5f9; }
        .condition-table th.today-header { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .condition-table td { background: #1e293b; color: #e2e8f0; word-wrap: break-word; }
        .condition-table td.today-col { background: rgba(59, 130, 246, 0.15); }
        .condition-table .category-group { background: linear-gradient(135deg, #1e3a5f, #0f172a); color: #f1f5f9; font-weight: 600; font-size: 13px; text-align: center; width: 60px; min-width: 60px; max-width: 60px; }
        .condition-table .category-cell { background: #0f172a; color: #94a3b8; font-weight: 500; text-align: left; padding-left: 8px; white-space: nowrap; width: 70px; min-width: 70px; max-width: 70px; }
        .condition-table .data-cell { font-size: 12px; }
        .condition-table .data-cell.long-text { font-size: 10px; }
        .condition-table .no-data { color: #475569; font-style: italic; }
        .condition-table .rpe-cell { font-weight: 600; }
        .condition-table .rpe-low { color: #4ade80; }
        .condition-table .rpe-mid { color: #facc15; }
        .condition-table .rpe-high { color: #f87171; }
        
        /* ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ */
        .refresh-btn { background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; color: #60a5fa; padding: 8px 14px; border-radius: 8px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
        .refresh-btn:hover { background: rgba(59, 130, 246, 0.3); }
        .refresh-btn.loading { opacity: 0.6; pointer-events: none; }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 600px) {
            .menu-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .form-row-3 { grid-template-columns: 1fr; }
            .checkbox-grid { grid-template-columns: repeat(2, 1fr); }
            .condition-grid { grid-template-columns: 1fr; }
            .test-value-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="screen active" id="loginScreen">
        <div class="login-wrapper">
            <div class="login-container">
                <div class="logo">
                    <span>ğŸ“‹</span>
                    <h1>Stribe Coach</h1>
                    <p>ì½”ì¹­ ìŠ¤íƒœí”„ ì „ìš©</p>
                </div>
                <div class="input-group">
                    <label>ì•„ì´ë””</label>
                    <input type="text" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button class="login-btn" id="loginBtn">ë¡œê·¸ì¸</button>
                <p class="error-msg" id="errorMsg"></p>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <div class="screen" id="mainScreen">
        <div class="dashboard">
            <div class="header">
                <div>
                    <div class="header-title">Stribe Coach</div>
                    <div class="header-date" id="todayDate"></div>
                </div>
                <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            
            <div class="menu-grid">
                <div class="menu-card" data-menu="condition">
                    <div class="menu-icon">ğŸ“Š</div>
                    <div class="menu-title">Personal Condition</div>
                    <div class="menu-desc">ì„ ìˆ˜ ì»¨ë””ì…˜ ë°ì´í„° ì¡°íšŒ</div>
                </div>
                <div class="menu-card" data-menu="training">
                    <div class="menu-icon">ğŸ“</div>
                    <div class="menu-title">Training Log</div>
                    <div class="menu-desc">í›ˆë ¨ ì¼ì§€ ì‘ì„±</div>
                </div>
                <div class="menu-card" data-menu="strategy">
                    <div class="menu-icon">ğŸ¯</div>
                    <div class="menu-title">Conditioning Strategy</div>
                    <div class="menu-desc">ì„ ìˆ˜ë³„ ê³¼ì œ ì§€ì •</div>
                </div>
                <div class="menu-card" data-menu="test">
                    <div class="menu-icon">ğŸ”¬</div>
                    <div class="menu-title">Test Result</div>
                    <div class="menu-desc">í”¼ì§€ì»¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì…ë ¥</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Personal Condition Check -->
    <div class="screen" id="conditionScreen">
        <div class="sub-header">
            <button class="back-btn" data-back="main">â†</button>
            <div class="sub-title">Personal Condition Check</div>
            <button class="refresh-btn" id="refreshCondition" style="margin-left: auto;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                </div>
                <div class="player-select-grid" id="conditionPlayerGrid"></div>
            </div>
            
            <div id="conditionDataContainer">
                <div class="empty-state">
                    <div class="icon">ğŸ‘¤</div>
                    <div class="text">ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Log -->
    <div class="screen" id="trainingScreen">
        <div class="sub-header">
            <button class="back-btn" data-back="main">â†</button>
            <div class="sub-title">Training Log</div>
            <button class="refresh-btn" id="refreshTraining" style="margin-left: auto;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="input">âœï¸ ì…ë ¥</button>
                <button class="tab-btn" data-tab="history">ğŸ“‹ ê¸°ë¡</button>
            </div>
            
            <div id="trainingInputTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“ í›ˆë ¨ ì¼ì§€ ì‘ì„±</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›ˆë ¨ ì¼ì‹œ</label>
                        <input type="datetime-local" class="form-input" id="trainingDateTime">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">í›ˆë ¨ ì»¨ì…‰</label>
                            <select class="form-select" id="trainingConcept">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="í•„ë“œí›ˆë ¨">í•„ë“œí›ˆë ¨</option>
                                <option value="ì§í›ˆë ¨">ì§í›ˆë ¨</option>
                                <option value="í•„ë“œ+ì§">í•„ë“œ+ì§</option>
                                <option value="ì „ìˆ í›ˆë ¨">ì „ìˆ í›ˆë ¨</option>
                                <option value="íšŒë³µí›ˆë ¨">íšŒë³µí›ˆë ¨</option>
                                <option value="ê²½ê¸°">ê²½ê¸°</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">í›ˆë ¨ ì‹œê°„ (ë¶„)</label>
                            <input type="number" class="form-input" id="trainingDuration" placeholder="90">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›ˆë ¨ ëª©ì </label>
                        <input type="text" class="form-input" id="trainingPurpose" placeholder="ì˜ˆ: ì²´ë ¥ ê°•í™”, ì „ìˆ  ìˆ™ë‹¬">
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›ˆë ¨ ë‚´ìš©</label>
                        <textarea class="form-textarea" id="trainingContent" placeholder="í›ˆë ¨ ì„¸ë¶€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button class="btn btn-primary btn-full" id="saveTrainingBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="trainingStatus"></div>
                </div>
            </div>
            
            <div id="trainingHistoryTab" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“‹ í›ˆë ¨ ê¸°ë¡</div>
                    </div>
                    <div id="trainingHistoryList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conditioning Strategy -->
    <div class="screen" id="strategyScreen">
        <div class="sub-header">
            <button class="back-btn" data-back="main">â†</button>
            <div class="sub-title">Conditioning Strategy</div>
            <button class="refresh-btn" id="refreshStrategy" style="margin-left: auto;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                </div>
                <div class="player-select-grid" id="strategyPlayerGrid"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ¯ ê³¼ì œ ì§€ì •</div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì ìš© ë‚ ì§œ</label>
                    <div class="form-input" id="strategyDateDisplay" style="background: #1e293b; color: #3b82f6; font-weight: 600;">TODAY</div>
                    <input type="hidden" id="strategyDate">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ¥— ì˜ì–‘ ì„­ì·¨</label>
                    <div class="form-row-3">
                        <div>
                            <label class="form-label" style="font-size: 12px; color: #64748b;">ìˆ˜ë¶„ ì„­ì·¨ (L)</label>
                            <input type="number" class="form-input" id="strategyWater" step="0.25" placeholder="2.5">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 12px; color: #64748b;">ë‹¨ë°±ì§ˆ (íšŒ)</label>
                            <input type="number" class="form-input" id="strategyProtein" placeholder="4">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 12px; color: #64748b;">ì¶”ê°€ ì„­ì·¨</label>
                            <input type="text" class="form-input" id="strategyFood" placeholder="ì˜ˆ: ë°”ë‚˜ë‚˜">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ©¹ íšŒë³µ ì „ëµ</label>
                    <div class="checkbox-grid" id="strategyRecoveryGrid">
                        <label class="checkbox-item" data-value="í¼ë¡¤ëŸ¬">
                            <input type="checkbox">
                            <div class="checkbox-box"></div>
                            <span class="checkbox-label">í¼ë¡¤ëŸ¬</span>
                        </label>
                        <label class="checkbox-item" data-value="ìŠ¤íŠ¸ë ˆì¹­">
                            <input type="checkbox">
                            <div class="checkbox-box"></div>
                            <span class="checkbox-label">ìŠ¤íŠ¸ë ˆì¹­</span>
                        </label>
                        <label class="checkbox-item" data-value="ëƒ‰ì°œì§ˆ/ëƒ‰ìš•">
                            <input type="checkbox">
                            <div class="checkbox-box"></div>
                            <span class="checkbox-label">ëƒ‰ì°œì§ˆ/ëƒ‰ìš•</span>
                        </label>
                        <label class="checkbox-item" data-value="ë¬¼ë¦¬ì¹˜ë£Œ">
                            <input type="checkbox">
                            <div class="checkbox-box"></div>
                            <span class="checkbox-label">ë¬¼ë¦¬ì¹˜ë£Œ</span>
                        </label>
                        <label class="checkbox-item" data-value="í•œë°©ì¹˜ë£Œ">
                            <input type="checkbox">
                            <div class="checkbox-box"></div>
                            <span class="checkbox-label">í•œë°©ì¹˜ë£Œ</span>
                        </label>
                        <label class="checkbox-item" data-value="ì••ë°•ì˜ë¥˜">
                            <input type="checkbox">
                            <div class="checkbox-box"></div>
                            <span class="checkbox-label">ì••ë°•ì˜ë¥˜</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ‹ï¸ ë³´ì¶© í›ˆë ¨</label>
                    <input type="text" class="form-input" id="strategyExercise" placeholder="ë³´ì¶© í›ˆë ¨ ë‚´ìš©">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ”— ì˜ìƒ ë§í¬</label>
                    <input type="url" class="form-input" id="strategyVideoLink" placeholder="https://youtube.com/...">
                </div>
                <button class="btn btn-primary btn-full" id="saveStrategyBtn">ì €ì¥í•˜ê¸°</button>
                <div id="strategyStatus"></div>
            </div>
        </div>
    </div>

    <!-- Test Result & Analysis -->
    <div class="screen" id="testScreen">
        <div class="sub-header">
            <button class="back-btn" data-back="main">â†</button>
            <div class="sub-title">Test Result & Analysis</div>
            <button class="refresh-btn" id="refreshTest" style="margin-left: auto;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="sub-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ì„ ìˆ˜ ì„ íƒ</div>
                </div>
                <div class="player-select-grid" id="testPlayerGrid"></div>
            </div>
            
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="inbody">ì¸ë°”ë””</button>
                <button class="tab-btn" data-tab="fms">FMS</button>
                <button class="tab-btn" data-tab="running">ëŸ°ë‹ ëŠ¥ë ¥</button>
            </div>
            
            <!-- ì¸ë°”ë”” íƒ­ -->
            <div id="inbodyTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“ ì¸ë°”ë”” ì¸¡ì •</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¸¡ì • ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="inbodyDate">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì‹ ì¥ (cm)</label>
                            <input type="number" class="form-input" id="inbodyHeight" step="0.1" placeholder="175.5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì²´ì¤‘ (kg)</label>
                            <input type="number" class="form-input" id="inbodyWeight" step="0.1" placeholder="70.5">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì²´ì§€ë°©ëŸ‰ (kg)</label>
                            <input type="number" class="form-input" id="inbodyFatMass" step="0.1" placeholder="12.5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì²´ì§€ë°©ë¥  (%)</label>
                            <input type="number" class="form-input" id="inbodyFatPercent" step="0.1" placeholder="15.5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê³¨ê²©ê·¼ëŸ‰ (kg)</label>
                        <input type="number" class="form-input" id="inbodyMuscle" step="0.1" placeholder="35.5">
                    </div>
                    <button class="btn btn-primary btn-full" id="saveInbodyBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="inbodyStatus"></div>
                </div>
            </div>
            
            <!-- FMS íƒ­ -->
            <div id="fmsTab" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸƒ FMS í‰ê°€</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¸¡ì • ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="fmsDate">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Deep Squat (0-3)</label>
                            <input type="number" class="form-input" id="fmsDeepSquat" min="0" max="3" placeholder="2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hurdle Step (0-3)</label>
                            <input type="number" class="form-input" id="fmsHurdleStep" min="0" max="3" placeholder="2">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Inline Lunge (0-3)</label>
                            <input type="number" class="form-input" id="fmsInlineLunge" min="0" max="3" placeholder="2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shoulder Mobility (0-3)</label>
                            <input type="number" class="form-input" id="fmsShoulderMob" min="0" max="3" placeholder="2">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ASLR (0-3)</label>
                            <input type="number" class="form-input" id="fmsASLR" min="0" max="3" placeholder="2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Trunk Stability (0-3)</label>
                            <input type="number" class="form-input" id="fmsTrunkStability" min="0" max="3" placeholder="2">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rotary Stability (0-3)</label>
                        <input type="number" class="form-input" id="fmsRotaryStability" min="0" max="3" placeholder="2">
                    </div>
                    <button class="btn btn-primary btn-full" id="saveFmsBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="fmsStatus"></div>
                </div>
            </div>
            
            <!-- ëŸ°ë‹ ëŠ¥ë ¥ íƒ­ -->
            <div id="runningTab" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸƒâ€â™‚ï¸ ëŸ°ë‹ ëŠ¥ë ¥ ì¸¡ì •</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¸¡ì • ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="runningDate">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">MAS (km/h)</label>
                            <input type="number" class="form-input" id="runningMAS" step="0.1" placeholder="16.5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Velocity (km/h)</label>
                            <input type="number" class="form-input" id="runningMaxVel" step="0.1" placeholder="32.0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">VO2max (ml/kg/min)</label>
                            <input type="number" class="form-input" id="runningVO2max" step="0.1" placeholder="55.0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lactate Phase 2 (km/h)</label>
                            <input type="number" class="form-input" id="runningLactate2" step="0.1" placeholder="12.5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lactate Phase 3 (km/h)</label>
                        <input type="number" class="form-input" id="runningLactate3" step="0.1" placeholder="14.5">
                    </div>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #334155;">
                        <label class="form-label" style="font-size: 15px; margin-bottom: 15px;">âš¡ ìŠ¤í”„ë¦°íŠ¸ ê¸°ë¡</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">10m (ì´ˆ)</label>
                                <input type="number" class="form-input" id="sprint10m" step="0.01" placeholder="1.85">
                            </div>
                            <div class="form-group">
                                <label class="form-label">30m (ì´ˆ)</label>
                                <input type="number" class="form-input" id="sprint30m" step="0.01" placeholder="4.25">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">50m (ì´ˆ)</label>
                                <input type="number" class="form-input" id="sprint50m" step="0.01" placeholder="6.50">
                            </div>
                            <div class="form-group">
                                <label class="form-label">100m (ì´ˆ)</label>
                                <input type="number" class="form-input" id="sprint100m" step="0.01" placeholder="12.80">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" id="saveRunningBtn">ì €ì¥í•˜ê¸°</button>
                    <div id="runningStatus"></div>
                </div>
            </div>
        </div>
    </div>

<script>
// =====================================================
// ì„¤ì •
// =====================================================
const API_URL = "https://script.google.com/macros/s/AKfycby3LKIkLnSLncriZbhlZt7Gly8r6NGw2p17QCfQIKLtXDjvdOFfJXu_WM5OMaOYt0pe/exec";

// ì½”ì¹˜ ê³„ì • (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê´€ë¦¬)
const COACHES = [
    { id: "coach", pw: "1234", name: "ì½”ì¹˜" },
    { id: "admin", pw: "admin", name: "ê´€ë¦¬ì" }
];

let currentCoach = null;
let players = [];
let selectedPlayers = [];
let conditionData = [];
let currentSelectedPlayer = null; // í˜„ì¬ ì„ íƒëœ ì„ ìˆ˜ (ì»¨ë””ì…˜ ì²´í¬ìš©)

// =====================================================
// ì´ˆê¸°í™”
// =====================================================
document.addEventListener('DOMContentLoaded', function() {
    initDate();
    loadPlayers();
    setupEventListeners();
});

function initDate() {
    const today = new Date();
    const dateStr = today.toLocaleDateString('ko-KR', { 
        year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' 
    });
    document.getElementById('todayDate').textContent = dateStr;
    
    // ë‚ ì§œ ì…ë ¥ ê¸°ë³¸ê°’
    const isoDate = today.toISOString().split('T')[0];
    document.getElementById('strategyDate').value = isoDate;
    document.getElementById('inbodyDate').value = isoDate;
    document.getElementById('fmsDate').value = isoDate;
    document.getElementById('runningDate').value = isoDate;
    
    // ê³¼ì œì§€ì • ë‚ ì§œ í‘œì‹œ (TODAY + ì‹¤ì œ ë‚ ì§œ)
    const todayDisplay = today.toLocaleDateString('ko-KR', { 
        month: 'long', day: 'numeric', weekday: 'short' 
    });
    document.getElementById('strategyDateDisplay').textContent = 'TODAY - ' + todayDisplay;
    
    // datetime-local ê¸°ë³¸ê°’
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('trainingDateTime').value = now.toISOString().slice(0, 16);
}

function loadPlayers() {
    fetch(API_URL)
        .then(r => r.json())
        .then(data => {
            players = data.map(p => ({
                name: p.name,
                birth: p.birthdate,
                team: p.team,
                pos: p.position,
                sport: p.sport
            }));
            renderPlayerGrids();
        })
        .catch(() => {
            // ì˜¤í”„ë¼ì¸ í´ë°±
            players = [
                { name: "í™ê¸¸ë™", pos: "FW", team: "ëŒ€ì „í•˜ë‚˜ì‹œí‹°ì¦Œ U18" },
                { name: "ê¹€ì² ìˆ˜", pos: "MF", team: "ëŒ€ì „í•˜ë‚˜ì‹œí‹°ì¦Œ U18" },
                { name: "ì´ì˜í¬", pos: "DF", team: "ëŒ€ì „í•˜ë‚˜ì‹œí‹°ì¦Œ U18" }
            ];
            renderPlayerGrids();
        });
}

function renderPlayerGrids() {
    const grids = ['conditionPlayerGrid', 'strategyPlayerGrid', 'testPlayerGrid'];
    grids.forEach(gridId => {
        const grid = document.getElementById(gridId);
        if (!grid) return;
        
        grid.innerHTML = players.map(p => `
            <div class="player-chip" data-player="${p.name}">
                <div class="name">${p.name}</div>
                <div class="pos">${p.pos || ''}</div>
            </div>
        `).join('');
        
        // í´ë¦­ ì´ë²¤íŠ¸
        grid.querySelectorAll('.player-chip').forEach(chip => {
            chip.addEventListener('click', function() {
                // ëª¨ë“  ê·¸ë¦¬ë“œì—ì„œ ë‹¨ì¼ ì„ íƒìœ¼ë¡œ ë³€ê²½
                grid.querySelectorAll('.player-chip').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                // ì»¨ë””ì…˜ í™”ë©´ì—ì„œëŠ” ë°”ë¡œ ë°ì´í„° ë¡œë“œ
                if (gridId === 'conditionPlayerGrid') {
                    currentSelectedPlayer = this.dataset.player;
                    loadConditionData(currentSelectedPlayer);
                }
            });
        });
    });
}

function updateSelectedPlayers(gridId) {
    const grid = document.getElementById(gridId);
    selectedPlayers = Array.from(grid.querySelectorAll('.player-chip.selected'))
        .map(chip => chip.dataset.player);
}

// =====================================================
// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
// =====================================================
function setupEventListeners() {
    // ë¡œê·¸ì¸
    document.getElementById('loginBtn').addEventListener('click', handleLogin);
    document.getElementById('loginPw').addEventListener('keypress', e => {
        if (e.key === 'Enter') handleLogin();
    });
    
    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    
    // ë©”ë‰´ ì¹´ë“œ
    document.querySelectorAll('.menu-card').forEach(card => {
        card.addEventListener('click', function() {
            const menu = this.dataset.menu;
            showScreen(menu + 'Screen');
        });
    });
    
    // ë’¤ë¡œê°€ê¸°
    document.querySelectorAll('.back-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            showScreen('mainScreen');
        });
    });
    
    // íƒ­ ì „í™˜
    setupTabNavigation();
    
    // ì²´í¬ë°•ìŠ¤ í† ê¸€
    document.querySelectorAll('.checkbox-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.toggle('checked');
            const checkbox = this.querySelector('input');
            checkbox.checked = this.classList.contains('checked');
        });
    });
    
    // ì €ì¥ ë²„íŠ¼ë“¤
    document.getElementById('saveTrainingBtn').addEventListener('click', saveTrainingLog);
    document.getElementById('saveStrategyBtn').addEventListener('click', saveStrategy);
    document.getElementById('saveInbodyBtn').addEventListener('click', () => saveTestResult('inbody'));
    document.getElementById('saveFmsBtn').addEventListener('click', () => saveTestResult('fms'));
    document.getElementById('saveRunningBtn').addEventListener('click', () => saveTestResult('running'));
    
    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ë“¤
    document.getElementById('refreshCondition').addEventListener('click', function() {
        if (currentSelectedPlayer) {
            this.classList.add('loading');
            this.textContent = 'ë¡œë”©...';
            loadConditionData(currentSelectedPlayer);
            setTimeout(() => {
                this.classList.remove('loading');
                this.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
            }, 1000);
        }
    });
    
    document.getElementById('refreshTraining').addEventListener('click', function() {
        this.classList.add('loading');
        this.textContent = 'ë¡œë”©...';
        loadTrainingHistory();
        setTimeout(() => {
            this.classList.remove('loading');
            this.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
        }, 1000);
    });
    
    document.getElementById('refreshStrategy').addEventListener('click', function() {
        this.classList.add('loading');
        this.textContent = 'ë¡œë”©...';
        loadPlayers();
        setTimeout(() => {
            this.classList.remove('loading');
            this.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
        }, 1000);
    });
    
    document.getElementById('refreshTest').addEventListener('click', function() {
        this.classList.add('loading');
        this.textContent = 'ë¡œë”©...';
        loadPlayers();
        setTimeout(() => {
            this.classList.remove('loading');
            this.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
        }, 1000);
    });
}

function setupTabNavigation() {
    document.querySelectorAll('.tab-nav').forEach(nav => {
        nav.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // ê°™ì€ nav ë‚´ì˜ ë²„íŠ¼ë“¤
                nav.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const tab = this.dataset.tab;
                const screen = nav.closest('.screen');
                
                // Training Log íƒ­
                if (screen.id === 'trainingScreen') {
                    document.getElementById('trainingInputTab').style.display = tab === 'input' ? 'block' : 'none';
                    document.getElementById('trainingHistoryTab').style.display = tab === 'history' ? 'block' : 'none';
                    if (tab === 'history') loadTrainingHistory();
                }
                
                // Test Result íƒ­
                if (screen.id === 'testScreen') {
                    document.getElementById('inbodyTab').style.display = tab === 'inbody' ? 'block' : 'none';
                    document.getElementById('fmsTab').style.display = tab === 'fms' ? 'block' : 'none';
                    document.getElementById('runningTab').style.display = tab === 'running' ? 'block' : 'none';
                }
            });
        });
    });
}

// =====================================================
// ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
// =====================================================
function handleLogin() {
    const id = document.getElementById('loginId').value.trim();
    const pw = document.getElementById('loginPw').value;
    const errorMsg = document.getElementById('errorMsg');
    
    const coach = COACHES.find(c => c.id === id && c.pw === pw);
    
    if (coach) {
        currentCoach = coach;
        showScreen('mainScreen');
        errorMsg.style.display = 'none';
    } else {
        errorMsg.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        errorMsg.style.display = 'block';
    }
}

function handleLogout() {
    currentCoach = null;
    showScreen('loginScreen');
    document.getElementById('loginId').value = '';
    document.getElementById('loginPw').value = '';
}

// =====================================================
// í™”ë©´ ì „í™˜
// =====================================================
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
}

// =====================================================
// Personal Condition Check - 7ì¼ í…Œì´ë¸” í˜•ì‹
// =====================================================
function loadConditionData(playerName) {
    const container = document.getElementById('conditionDataContainer');
    
    if (!playerName) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="icon">ğŸ‘¤</div>
                <div class="text">ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = `
        <div class="loading">
            <div class="loading-spinner"></div>
            <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
    `;
    
    // ìµœê·¼ 6ì¼ ë‚ ì§œ ê³„ì‚° (D-6 ~ D-1, TODAY ì œì™¸)
    const dates = [];
    const today = new Date();
    for (let i = 6; i >= 1; i--) {
        const d = new Date(today);
        d.setDate(d.getDate() - i);
        dates.push({
            label: `D-${i}`,
            date: d.toISOString().split('T')[0],
            display: `${d.getMonth() + 1}/${d.getDate()}`
        });
    }
    
    // API í˜¸ì¶œ - ìµœê·¼ 6ì¼ ë°ì´í„°
    const dateFrom = dates[0].date;
    const dateTo = dates[5].date;
    
    const params = new URLSearchParams({
        action: 'getConditions',
        dateFrom: dateFrom,
        dateTo: dateTo,
        players: playerName
    });
    
    fetch(API_URL + '?' + params.toString())
        .then(r => r.json())
        .then(data => {
            renderConditionTable(playerName, dates, data);
        })
        .catch(() => {
            // ë°ëª¨ ë°ì´í„°
            const demoData = generateDemoConditionData7Days(playerName, dates);
            renderConditionTable(playerName, dates, demoData);
        });
}

function generateDemoConditionData7Days(playerName, dates) {
    // ë°ëª¨ìš© - ì¼ë¶€ ë‚ ì§œë§Œ ë°ì´í„° ìˆìŒ
    return dates.filter((_, i) => i % 2 === 0 || i === 6).map(d => ({
        player: playerName,
        date: d.date,
        breakfast: '07:30',
        lunch: '12:00',
        dinner: '18:30',
        protein: Math.floor(Math.random() * 3) + 3,
        water: (Math.random() * 1.5 + 1.5).toFixed(1),
        injury: Math.random() > 0.7 ? 'ì˜¤ë¥¸ìª½ í–„ìŠ¤íŠ¸ë§' : 'ì—†ìŒ',
        recovery: 'í¼ë¡¤ëŸ¬, ìŠ¤íŠ¸ë ˆì¹­',
        rpe: Math.floor(Math.random() * 5) + 4,
        trainingTime: [60, 90, 120][Math.floor(Math.random() * 3)],
        trainingConcept: ['í•„ë“œ', 'ì§', 'í•„ë“œ+ì§'][Math.floor(Math.random() * 3)],
        painNote: ''
    }));
}

function renderConditionTable(playerName, dates, data) {
    const container = document.getElementById('conditionDataContainer');
    
    // ë‚ ì§œë³„ ë°ì´í„° ë§¤í•‘
    const dataByDate = {};
    data.forEach(d => {
        dataByDate[d.date] = d;
    });
    
    // ë””ë²„ê¹…
    console.log('Data received:', data);
    console.log('Data by date:', dataByDate);
    
    // ì‹œê°„ í¬ë§·íŒ… í—¬í¼ (1899-12-30T04:02:08.000Z -> 04:02 ë˜ëŠ” HH:MM)
    const formatTime = (val) => {
        if (!val) return null;
        const str = String(val);
        
        // ì´ë¯¸ HH:MM í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ
        if (/^\d{1,2}:\d{2}$/.test(str)) return str;
        
        // ISO ë‚ ì§œ í˜•ì‹ì—ì„œ ì‹œê°„ ì¶”ì¶œ (1899-12-30T04:02:08.000Z)
        if (str.includes('T')) {
            const timePart = str.split('T')[1];
            if (timePart) {
                const hm = timePart.substring(0, 5); // HH:MM
                return hm;
            }
        }
        
        // Date ê°ì²´ì¸ ê²½ìš°
        if (str.includes('GMT') || str.includes('UTC')) {
            try {
                const d = new Date(val);
                const h = String(d.getHours()).padStart(2, '0');
                const m = String(d.getMinutes()).padStart(2, '0');
                return h + ':' + m;
            } catch (e) {
                return str;
            }
        }
        
        return str;
    };
    
    // ê°’ ê°€ì ¸ì˜¤ê¸° í—¬í¼ (ê¸´ í…ìŠ¤íŠ¸ëŠ” ì‘ì€ ê¸€ì”¨ë¡œ)
    const getValue = (date, field) => {
        const d = dataByDate[date];
        if (!d) return '<span class="no-data">-</span>';
        const val = d[field];
        if (val === undefined || val === null || val === '') return '<span class="no-data">-</span>';
        
        // ì‹œê°„ í•„ë“œëŠ” í¬ë§·íŒ…
        if (field === 'breakfast' || field === 'lunch' || field === 'dinner') {
            const formatted = formatTime(val);
            return formatted || '<span class="no-data">-</span>';
        }
        
        // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ í´ë˜ìŠ¤ ì ìš©
        const str = String(val);
        if (str.length > 6) {
            return `<span class="long-text">${str}</span>`;
        }
        return str;
    };
    
    // RPE ê°’ (ìƒ‰ìƒ í¬í•¨)
    const getRpeValue = (date) => {
        const d = dataByDate[date];
        if (!d || !d.rpe) return '<span class="no-data">-</span>';
        const rpe = parseInt(d.rpe);
        const rpeClass = rpe <= 4 ? 'rpe-low' : (rpe <= 7 ? 'rpe-mid' : 'rpe-high');
        return `<span class="rpe-cell ${rpeClass}">${rpe}</span>`;
    };
    
    // í…Œì´ë¸” ìƒì„± - ì™¼ìª½ì— ì¹´í…Œê³ ë¦¬ ê·¸ë£¹ ì—´ ì¶”ê°€
    let html = `
    <div class="card" style="padding: 15px;">
        <div class="card-header">
            <div class="card-title">ğŸ“Š ${playerName} - ìµœê·¼ 6ì¼ ì»¨ë””ì…˜</div>
        </div>
        <div class="condition-table-wrapper">
            <table class="condition-table">
                <colgroup>
                    <col style="width: 60px;">
                    <col style="width: 70px;">
                    ${dates.map(() => `<col style="width: calc((100% - 130px) / 6);">`).join('')}
                </colgroup>
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        ${dates.map(d => `
                            <th class="day-header">
                                ${d.label}<br><span style="font-weight: 400; font-size: 11px;">${d.display}</span>
                            </th>
                        `).join('')}
                    </tr>
                </thead>
                <tbody>
                    <!-- ì˜ì–‘ ì„¹ì…˜ -->
                    <tr>
                        <td class="category-group" rowspan="5">ğŸ¥— ì˜ì–‘</td>
                        <td class="category-cell">ì•„ì¹¨</td>
                        ${dates.map(d => `<td>${getValue(d.date, 'breakfast')}</td>`).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">ì ì‹¬</td>
                        ${dates.map(d => `<td>${getValue(d.date, 'lunch')}</td>`).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">ì €ë…</td>
                        ${dates.map(d => `<td>${getValue(d.date, 'dinner')}</td>`).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">ë‹¨ë°±ì§ˆ</td>
                        ${dates.map(d => {
                            const val = getValue(d.date, 'protein');
                            return `<td>${val !== '<span class="no-data">-</span>' ? val + 'íšŒ' : val}</td>`;
                        }).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">ìˆ˜ë¶„</td>
                        ${dates.map(d => {
                            const val = getValue(d.date, 'water');
                            return `<td>${val !== '<span class="no-data">-</span>' ? val + 'L' : val}</td>`;
                        }).join('')}
                    </tr>
                    
                    <!-- íšŒë³µ ì„¹ì…˜ -->
                    <tr>
                        <td class="category-group" rowspan="2">ğŸ©¹ íšŒë³µ</td>
                        <td class="category-cell">ë¶€ìƒ/í†µì¦</td>
                        ${dates.map(d => `<td>${getValue(d.date, 'injury')}</td>`).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">íšŒë³µì „ëµ</td>
                        ${dates.map(d => `<td>${getValue(d.date, 'recovery')}</td>`).join('')}
                    </tr>
                    
                    <!-- í›ˆë ¨ ì„¹ì…˜ -->
                    <tr>
                        <td class="category-group" rowspan="3">ğŸ’ª í›ˆë ¨</td>
                        <td class="category-cell">ì»¨ì…‰</td>
                        ${dates.map(d => `<td>${getValue(d.date, 'trainingConcept')}</td>`).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">ì‹œê°„</td>
                        ${dates.map(d => {
                            const val = getValue(d.date, 'trainingTime');
                            return `<td>${val !== '<span class="no-data">-</span>' ? val + 'ë¶„' : val}</td>`;
                        }).join('')}
                    </tr>
                    <tr>
                        <td class="category-cell">RPE</td>
                        ${dates.map(d => `<td>${getRpeValue(d.date)}</td>`).join('')}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>`;
    
    container.innerHTML = html;
}

// =====================================================
// Training Log
// =====================================================
function saveTrainingLog() {
    const btn = document.getElementById('saveTrainingBtn');
    const status = document.getElementById('trainingStatus');
    
    const data = {
        action: 'saveTrainingLog',
        datetime: document.getElementById('trainingDateTime').value,
        concept: document.getElementById('trainingConcept').value,
        duration: document.getElementById('trainingDuration').value,
        purpose: document.getElementById('trainingPurpose').value,
        content: document.getElementById('trainingContent').value
    };
    
    if (!data.datetime || !data.concept || !data.duration) {
        showStatus(status, 'í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
    }
    
    btn.disabled = true;
    btn.textContent = 'ì €ì¥ ì¤‘...';
    
    const params = new URLSearchParams(data);
    
    fetch(API_URL + '?' + params.toString())
        .then(r => r.json())
        .then(result => {
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            if (result.success) {
                showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                clearTrainingForm();
            } else {
                showStatus(status, 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        })
        .catch(() => {
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            // ë°ëª¨: ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
            showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ë°ëª¨)', 'success');
            clearTrainingForm();
        });
}

function clearTrainingForm() {
    document.getElementById('trainingConcept').value = '';
    document.getElementById('trainingDuration').value = '';
    document.getElementById('trainingPurpose').value = '';
    document.getElementById('trainingContent').value = '';
}

function loadTrainingHistory() {
    const container = document.getElementById('trainingHistoryList');
    container.innerHTML = `
        <div class="loading">
            <div class="loading-spinner"></div>
            <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
    `;
    
    fetch(API_URL + '?action=getTrainingLogs')
        .then(r => r.json())
        .then(data => {
            renderTrainingHistory(data);
        })
        .catch(() => {
            // ë°ëª¨ ë°ì´í„°
            renderTrainingHistory([
                { datetime: '2024-01-15 10:00', concept: 'í•„ë“œí›ˆë ¨', duration: 90, purpose: 'ì²´ë ¥ ê°•í™”', content: 'ë‹¬ë¦¬ê¸° í›ˆë ¨ + íŒ¨ìŠ¤ ì—°ìŠµ' },
                { datetime: '2024-01-14 14:00', concept: 'ì§í›ˆë ¨', duration: 60, purpose: 'ê·¼ë ¥ ê°•í™”', content: 'í•˜ì²´ ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹' }
            ]);
        });
}

function renderTrainingHistory(data) {
    const container = document.getElementById('trainingHistoryList');
    
    if (!data || data.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="icon">ğŸ“‹</div>
                <div class="text">í›ˆë ¨ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = data.map(log => `
        <div class="condition-card">
            <div class="condition-header">
                <span class="condition-player">${log.concept}</span>
                <span class="condition-date">${log.datetime}</span>
            </div>
            <div class="condition-grid">
                <div class="condition-item">
                    <span class="condition-label">ì‹œê°„</span>
                    <span class="condition-value">${log.duration}ë¶„</span>
                </div>
                <div class="condition-item">
                    <span class="condition-label">ëª©ì </span>
                    <span class="condition-value">${log.purpose || '-'}</span>
                </div>
            </div>
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #334155;">
                <div class="condition-label" style="margin-bottom: 5px;">ë‚´ìš©</div>
                <div style="color: #e2e8f0; font-size: 14px; line-height: 1.5;">${log.content || '-'}</div>
            </div>
        </div>
    `).join('');
}

// =====================================================
// Conditioning Strategy
// =====================================================
function saveStrategy() {
    const btn = document.getElementById('saveStrategyBtn');
    const status = document.getElementById('strategyStatus');
    
    const selectedPlayer = document.querySelector('#strategyPlayerGrid .player-chip.selected');
    if (!selectedPlayer) {
        showStatus(status, 'ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
        return;
    }
    
    const recoveryMethods = Array.from(document.querySelectorAll('#strategyRecoveryGrid .checkbox-item.checked'))
        .map(item => item.dataset.value);
    
    const data = {
        action: 'saveStrategy',
        player: selectedPlayer.dataset.player,
        date: document.getElementById('strategyDate').value,
        water: document.getElementById('strategyWater').value,
        protein: document.getElementById('strategyProtein').value,
        food: document.getElementById('strategyFood').value,
        recovery: recoveryMethods.join(', '),
        exercise: document.getElementById('strategyExercise').value,
        videoLink: document.getElementById('strategyVideoLink').value
    };
    
    btn.disabled = true;
    btn.textContent = 'ì €ì¥ ì¤‘...';
    
    const params = new URLSearchParams(data);
    
    fetch(API_URL + '?' + params.toString())
        .then(r => r.json())
        .then(result => {
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            if (result.success) {
                showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } else {
                showStatus(status, 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        })
        .catch(() => {
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ë°ëª¨)', 'success');
        });
}

// =====================================================
// Test Result
// =====================================================
function saveTestResult(type) {
    const selectedPlayer = document.querySelector('#testPlayerGrid .player-chip.selected');
    let btn, status, data;
    
    if (!selectedPlayer) {
        const statusEl = document.getElementById(type + 'Status');
        showStatus(statusEl, 'ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
        return;
    }
    
    if (type === 'inbody') {
        btn = document.getElementById('saveInbodyBtn');
        status = document.getElementById('inbodyStatus');
        data = {
            action: 'saveTestResult',
            type: 'inbody',
            player: selectedPlayer.dataset.player,
            date: document.getElementById('inbodyDate').value,
            height: document.getElementById('inbodyHeight').value,
            weight: document.getElementById('inbodyWeight').value,
            fatMass: document.getElementById('inbodyFatMass').value,
            fatPercent: document.getElementById('inbodyFatPercent').value,
            muscle: document.getElementById('inbodyMuscle').value
        };
    } else if (type === 'fms') {
        btn = document.getElementById('saveFmsBtn');
        status = document.getElementById('fmsStatus');
        data = {
            action: 'saveTestResult',
            type: 'fms',
            player: selectedPlayer.dataset.player,
            date: document.getElementById('fmsDate').value,
            deepSquat: document.getElementById('fmsDeepSquat').value,
            hurdleStep: document.getElementById('fmsHurdleStep').value,
            inlineLunge: document.getElementById('fmsInlineLunge').value,
            shoulderMob: document.getElementById('fmsShoulderMob').value,
            aslr: document.getElementById('fmsASLR').value,
            trunkStability: document.getElementById('fmsTrunkStability').value,
            rotaryStability: document.getElementById('fmsRotaryStability').value
        };
    } else if (type === 'running') {
        btn = document.getElementById('saveRunningBtn');
        status = document.getElementById('runningStatus');
        data = {
            action: 'saveTestResult',
            type: 'running',
            player: selectedPlayer.dataset.player,
            date: document.getElementById('runningDate').value,
            mas: document.getElementById('runningMAS').value,
            maxVel: document.getElementById('runningMaxVel').value,
            vo2max: document.getElementById('runningVO2max').value,
            lactate2: document.getElementById('runningLactate2').value,
            lactate3: document.getElementById('runningLactate3').value,
            sprint10m: document.getElementById('sprint10m').value,
            sprint30m: document.getElementById('sprint30m').value,
            sprint50m: document.getElementById('sprint50m').value,
            sprint100m: document.getElementById('sprint100m').value
        };
    }
    
    btn.disabled = true;
    btn.textContent = 'ì €ì¥ ì¤‘...';
    
    const params = new URLSearchParams(data);
    
    fetch(API_URL + '?' + params.toString())
        .then(r => r.json())
        .then(result => {
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            if (result.success) {
                showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } else {
                showStatus(status, 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        })
        .catch(() => {
            btn.disabled = false;
            btn.textContent = 'ì €ì¥í•˜ê¸°';
            showStatus(status, 'âœ“ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ë°ëª¨)', 'success');
        });
}

// =====================================================
// ìœ í‹¸ë¦¬í‹°
// =====================================================
function showStatus(element, message, type) {
    element.innerHTML = `<div class="status-msg status-${type}">${message}</div>`;
    setTimeout(() => {
        element.innerHTML = '';
    }, 3000);
}
</script>
</body>
</html>
